"use strict";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var cosmic = document.querySelector(".cosmic");
var button = document.querySelector(".cosmic__how-btn-icon");
var close = document.querySelector(".popup__window-close");
var popup = document.querySelector(".popup");
var overflow = document.querySelector("body");
button.addEventListener("click", function () {
  cosmic.classList.add("blur");
  popup.style.display = "flex";
  overflow.style.overflow = "hidden";
});
close.addEventListener("click", function () {
  cosmic.classList.remove("blur");
  popup.style.display = "none";
  overflow.style.overflow = "visible";
}); // Slider

var prizesLeftArrow = document.querySelector('.controls-left'),
    prizesRightArrow = document.querySelector('.controls-right');
var slider1 = slider('prizes-slider', '.cosmic__prizes-slider-item', prizesLeftArrow, prizesRightArrow);

function slider(id, itemSelector, leftArrow, rightArrow, config) {
  var el = document.getElementById(id);
  el.classList.add('slider');
  var mediaStep = '';
  var activeIndIndex = 0;
  var toogleIndex = 0;
  var items = el.querySelectorAll(itemSelector);

  function getMediaStep() {
    var width = window.innerWidth;
    var newStep = width > (obj.config.media && obj.config.media.lg) ? 'lg' : width > (obj.config.media && obj.config.media.md) ? 'md' : width > (obj.config.media && obj.config.media.sm) ? 'sm' : 'xs';

    if (mediaStep !== newStep) {
      mediaStep = newStep;
      obj.buildSlider();
    }
  }

  function getItemsQuantity() {
    return obj.config.elemsPerPage[mediaStep];
  }

  function onResize() {
    getMediaStep();
  }

  var obj = {
    activeIndex: 0,
    activeIndIndex: activeIndIndex > 0 ? activeIndIndex : 0,
    toggleIndex: 0,
    init: function init() {
      getMediaStep();
      var startX = 0;
      var touched = false;
      var inner = el.querySelector('.slider-inner');
      var indicators = el.querySelectorAll('.slider-indicator');

      function onMouseDown(e) {
        startX = e.clientX || e.touches[0].clientX;
        touched = true;
        var weekly = document.querySelectorAll('.result__weeks-btn'); // for (const item of weekly) item.addEventListener('touchstart', selectWeek);
      }

      function onMouseMove(e) {
        e.preventDefault();

        if (touched) {
          inner = inner || el.querySelector('.slider-inner');
          var x = e.clientX || e.touches[0].clientX;
          var diff = x - startX;

          if (diff < 0 && activeIndIndex < indicators.length - 1 || diff > 0 && activeIndIndex > 0) {
            inner.style.transform = 'translateX(' + diff + 'px)';
          }
        }
      }

      function onMouseEnd(e) {
        if (touched) {
          var x = e.clientX || e.changedTouches[0].clientX;

          if (x - startX > 30) {
            toggleIndex(activeIndIndex - 1);
          } else if (startX - x > 30) {
            toggleIndex(activeIndIndex + 1);
          }

          inner = inner || el.querySelector('.slider-inner');
          inner.style.transform = '';
        }

        touched = false;
      }

      rightArrow.addEventListener('click', function () {
        toggleIndex(activeIndIndex + 1); // obj.next()
      });
      leftArrow.addEventListener('click', function () {
        toggleIndex(activeIndIndex - 1); // obj.prev()
      });
      window.removeEventListener('resize', onResize);
      window.addEventListener('resize', onResize);
      el.removeEventListener('mousedown', onMouseDown);
      el.removeEventListener('touchstart', onMouseDown);
      el.addEventListener('mousedown', onMouseDown);
      el.addEventListener('touchstart', onMouseDown);
      el.removeEventListener('mousemove', onMouseMove);
      el.removeEventListener('touchmove', onMouseMove);
      el.addEventListener('mousemove', onMouseMove); // el.addEventListener('touchmove', onMouseMove);

      window.removeEventListener('mouseup', onMouseEnd);
      window.removeEventListener('touchend', onMouseEnd);
      window.addEventListener('mouseup', onMouseEnd);
      window.addEventListener('touchend', onMouseEnd);
      return obj;
    },
    config: {
      elemsPerPage: _objectSpread(_objectSpread({}, {
        'lg': 3,
        'md': 3,
        'sm': 2,
        'xs': 1
      }), config && config.elemsPerPage || {}),
      media: _objectSpread(_objectSpread({}, {
        'lg': 1160,
        'md': 920,
        'sm': 700
      }), config && config.media || {})
    },
    buildSlider: function buildSlider() {
      obj.removeSlider();
      var wrapper = document.createElement("div");
      wrapper.className = 'slider-wrapper';
      var inner = document.createElement("div");
      inner.className = 'slider-inner';
      wrapper.appendChild(inner);
      el.appendChild(wrapper);

      if (obj.config.elemsPerPage[mediaStep] >= items.length + 1) {
        el.classList.add('not-enough-elems');
        return;
      }

      buildPages();
    },
    //     getMediaStep() {
    //     // var width = window.innerWidth;
    //     // var newStep = width > mediaConfig && mediaConfig.lg !== undefined ? mediaConfig.lg : 1150 ? 'lg'
    //     //     : width > (mediaConfig && mediaConfig.md !== undefined ? mediaConfig.md : 767) ? 'md'
    //     //         : width > (mediaConfig && mediaConfig.sm !== undefined ? mediaConfig.sm : 600) ? 'sm' : 'xs';
    //
    //     if (mediaStep !== newStep) {
    //         mediaStep = newStep;
    //         obj.buildSlider();
    //     }
    // },
    removeSlider: function removeSlider() {
      var wrapper = el.querySelector('.slider-wrapper');
      el.classList.remove('not-enough-elems');
      wrapper && wrapper.remove();
    },
    toggle: toggleIndex
  };

  function buildIndicators() {
    var prevInd = el.querySelector('.slider-indicators');
    prevInd && prevInd.remove();
    var indicators = document.createElement('div');
    indicators.classList.add('slider-indicators');

    var _loop = function _loop(i) {
      var indicator = document.createElement('div');
      indicator.classList.add('slider-indicator');

      if (i === activeIndIndex) {
        indicator.classList.add('active');
      }

      indicator.setAttribute('index', i);
      indicator.addEventListener('click', function () {
        toggleIndex(i);
      });
      indicators.appendChild(indicator);
    };

    for (var i = 0; i < Math.ceil(items.length / getItemsQuantity()); i++) {
      _loop(i);
    }

    var wrapper = el.querySelector('.slider-wrapper');
    wrapper.appendChild(indicators);
  }

  function buildPages(step) {
    step = step || 1;
    var pagePrev = buildPage(obj.activeIndex + items.length - getItemsQuantity() * step);
    var pageCurrent = buildPage(obj.activeIndex);
    var pageNext = buildPage(obj.activeIndex + getItemsQuantity() * step);
    var inner = el.querySelector('.slider-inner');

    if (getItemsQuantity() < items.length) {
      buildIndicators();

      if (!el.querySelector('.slider-indicator.active')) {// toggleIndex(0);
      }
    }

    inner.innerHTML = '';
    inner.appendChild(pagePrev);
    inner.appendChild(pageCurrent);
    inner.appendChild(pageNext);
  }

  function buildPage(index) {
    var page = document.createElement("div");
    page.classList.add('slider-page');

    for (var i = index; i < index + getItemsQuantity(); i++) {
      var item = items[i % items.length];
      var newItem = item.cloneNode(true);
      page.appendChild(newItem);
    }

    return page;
  }

  function toggleIndex(index) {
    var indActive = el.querySelector('.slider-indicator.active');
    var indicators = el.querySelectorAll('.slider-indicator');

    if (!indicators[index]) {
      return;
    }

    leftArrow.classList.remove('arrow-disabled');
    rightArrow.classList.remove('arrow-disabled');

    if (index === 0) {
      leftArrow.classList.add('arrow-disabled');
    }

    if (index === indicators.length - 1) {
      rightArrow.classList.add('arrow-disabled');
    }

    indActive && indActive.classList.remove('active');
    indicators[index] && indicators[index].classList.add('active');

    if (index > activeIndIndex) {
      index - activeIndIndex > 1 && buildPages(index - activeIndIndex);
      obj.next();
    } else if (index < activeIndIndex) {
      activeIndIndex - index > 1 && buildPages(activeIndIndex - index);
      obj.prev();
    }

    activeIndIndex = index; // document.querySelector('.current').textContent = activeIndIndex + 1;
  }

  obj.prev = function () {
    var wrapper = el.querySelector('.slider-wrapper');
    wrapper.classList.add('prev');
    setTimeout(function () {
      wrapper.classList.remove('prev');
      obj.activeIndex = (obj.activeIndex - getItemsQuantity() + items.length) % items.length;
      buildPages();
    }, 300);
  };

  obj.next = function () {
    var wrapper = el.querySelector('.slider-wrapper');
    wrapper.classList.add('next');
    setTimeout(function () {
      wrapper.classList.remove('next');
      obj.activeIndex = (obj.activeIndex + getItemsQuantity() + items.length) % items.length;
      buildPages();
    }, 300);
  };

  return obj.init();
}
"use strict";
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzZWNvbmQuanMiXSwibmFtZXMiOlsiY29zbWljIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYnV0dG9uIiwiY2xvc2UiLCJwb3B1cCIsIm92ZXJmbG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsYXNzTGlzdCIsImFkZCIsInN0eWxlIiwiZGlzcGxheSIsInJlbW92ZSIsInByaXplc0xlZnRBcnJvdyIsInByaXplc1JpZ2h0QXJyb3ciLCJzbGlkZXIxIiwic2xpZGVyIiwiaWQiLCJpdGVtU2VsZWN0b3IiLCJsZWZ0QXJyb3ciLCJyaWdodEFycm93IiwiY29uZmlnIiwiZWwiLCJnZXRFbGVtZW50QnlJZCIsIm1lZGlhU3RlcCIsImFjdGl2ZUluZEluZGV4IiwidG9vZ2xlSW5kZXgiLCJpdGVtcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJnZXRNZWRpYVN0ZXAiLCJ3aWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJuZXdTdGVwIiwib2JqIiwibWVkaWEiLCJsZyIsIm1kIiwic20iLCJidWlsZFNsaWRlciIsImdldEl0ZW1zUXVhbnRpdHkiLCJlbGVtc1BlclBhZ2UiLCJvblJlc2l6ZSIsImFjdGl2ZUluZGV4IiwidG9nZ2xlSW5kZXgiLCJpbml0Iiwic3RhcnRYIiwidG91Y2hlZCIsImlubmVyIiwiaW5kaWNhdG9ycyIsIm9uTW91c2VEb3duIiwiZSIsImNsaWVudFgiLCJ0b3VjaGVzIiwid2Vla2x5Iiwib25Nb3VzZU1vdmUiLCJwcmV2ZW50RGVmYXVsdCIsIngiLCJkaWZmIiwibGVuZ3RoIiwidHJhbnNmb3JtIiwib25Nb3VzZUVuZCIsImNoYW5nZWRUb3VjaGVzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbW92ZVNsaWRlciIsIndyYXBwZXIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwiYXBwZW5kQ2hpbGQiLCJidWlsZFBhZ2VzIiwidG9nZ2xlIiwiYnVpbGRJbmRpY2F0b3JzIiwicHJldkluZCIsImkiLCJpbmRpY2F0b3IiLCJzZXRBdHRyaWJ1dGUiLCJNYXRoIiwiY2VpbCIsInN0ZXAiLCJwYWdlUHJldiIsImJ1aWxkUGFnZSIsInBhZ2VDdXJyZW50IiwicGFnZU5leHQiLCJpbm5lckhUTUwiLCJpbmRleCIsInBhZ2UiLCJpdGVtIiwibmV3SXRlbSIsImNsb25lTm9kZSIsImluZEFjdGl2ZSIsIm5leHQiLCJwcmV2Iiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQSxJQUFNQSxNQUFNLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixTQUF2QixDQUFmO0FBQ0EsSUFBTUMsTUFBTSxHQUFHRixRQUFRLENBQUNDLGFBQVQsQ0FBdUIsdUJBQXZCLENBQWY7QUFDQSxJQUFNRSxLQUFLLEdBQUdILFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixzQkFBdkIsQ0FBZDtBQUNBLElBQU1HLEtBQUssR0FBR0osUUFBUSxDQUFDQyxhQUFULENBQXVCLFFBQXZCLENBQWQ7QUFDQSxJQUFNSSxRQUFRLEdBQUdMLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixNQUF2QixDQUFqQjtBQUVBQyxNQUFNLENBQUNJLGdCQUFQLENBQXdCLE9BQXhCLEVBQWlDLFlBQU07RUFDbkNQLE1BQU0sQ0FBQ1EsU0FBUCxDQUFpQkMsR0FBakIsQ0FBcUIsTUFBckI7RUFDQUosS0FBSyxDQUFDSyxLQUFOLENBQVlDLE9BQVosR0FBc0IsTUFBdEI7RUFDQUwsUUFBUSxDQUFDSSxLQUFULENBQWVKLFFBQWYsR0FBMEIsUUFBMUI7QUFDSCxDQUpEO0FBTUFGLEtBQUssQ0FBQ0csZ0JBQU4sQ0FBdUIsT0FBdkIsRUFBZ0MsWUFBTTtFQUNsQ1AsTUFBTSxDQUFDUSxTQUFQLENBQWlCSSxNQUFqQixDQUF3QixNQUF4QjtFQUNBUCxLQUFLLENBQUNLLEtBQU4sQ0FBWUMsT0FBWixHQUFzQixNQUF0QjtFQUNBTCxRQUFRLENBQUNJLEtBQVQsQ0FBZUosUUFBZixHQUEwQixTQUExQjtBQUNILENBSkQsRSxDQU1BOztBQUNBLElBQUlPLGVBQWUsR0FB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QyxHQUFsQixDQUFzQixNQUF0QjtJQUNBbUYsVUFBVSxDQUFDLFlBQVk7TUFDbkIzQixPQUFPLENBQUN6RCxTQUFSLENBQWtCSSxNQUFsQixDQUF5QixNQUF6QjtNQUNBc0IsR0FBRyxDQUFDUyxXQUFKLEdBQWtCLENBQUNULEdBQUcsQ0FBQ1MsV0FBSixHQUFrQkgsZ0JBQWdCLEVBQWxDLEdBQXVDYixLQUFLLENBQUNnQyxNQUE5QyxJQUF3RGhDLEtBQUssQ0FBQ2dDLE1BQWhGO01BQ0FVLFVBQVU7SUFDYixDQUpTLEVBSVAsR0FKTyxDQUFWO0VBS0gsQ0FSRDs7RUFTQSxPQUFPbkMsR0FBRyxDQUFDVyxJQUFKLEVBQVA7QUFDSDtBQ2hTRCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5jb25zdCBjb3NtaWMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNvc21pY1wiKTtcbmNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29zbWljX19ob3ctYnRuLWljb25cIik7XG5jb25zdCBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3dpbmRvdy1jbG9zZVwiKTtcbmNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cFwiKTtcbmNvbnN0IG92ZXJmbG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XG5cbmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvc21pYy5jbGFzc0xpc3QuYWRkKFwiYmx1clwiKVxuICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICBvdmVyZmxvdy5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG59KTtcblxuY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb3NtaWMuY2xhc3NMaXN0LnJlbW92ZShcImJsdXJcIilcbiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgb3ZlcmZsb3cuc3R5bGUub3ZlcmZsb3cgPSBcInZpc2libGVcIjtcbn0pO1xuXG4vLyBTbGlkZXJcbmxldCBwcml6ZXNMZWZ0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJvbHMtbGVmdCcpLFxuICAgIHByaXplc1JpZ2h0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJvbHMtcmlnaHQnKTtcblxudmFyIHNsaWRlcjEgPSBzbGlkZXIoXG4gICAgJ3ByaXplcy1zbGlkZXInLFxuICAgICcuY29zbWljX19wcml6ZXMtc2xpZGVyLWl0ZW0nLFxuICAgIHByaXplc0xlZnRBcnJvdywgcHJpemVzUmlnaHRBcnJvdyk7XG5cbmZ1bmN0aW9uIHNsaWRlcihpZCwgaXRlbVNlbGVjdG9yLCBsZWZ0QXJyb3csIHJpZ2h0QXJyb3csIGNvbmZpZykge1xuICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgICBlbC5jbGFzc0xpc3QuYWRkKCdzbGlkZXInKVxuICAgIHZhciBtZWRpYVN0ZXAgPSAnJztcbiAgICB2YXIgYWN0aXZlSW5kSW5kZXggPSAwO1xuICAgIHZhciB0b29nbGVJbmRleCA9IDA7XG4gICAgdmFyIGl0ZW1zID0gZWwucXVlcnlTZWxlY3RvckFsbChpdGVtU2VsZWN0b3IpO1xuXG4gICAgZnVuY3Rpb24gZ2V0TWVkaWFTdGVwKCkge1xuICAgICAgICB2YXIgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdmFyIG5ld1N0ZXAgPSB3aWR0aCA+IChvYmouY29uZmlnLm1lZGlhICYmIG9iai5jb25maWcubWVkaWEubGcpID8gJ2xnJ1xuICAgICAgICAgICAgOiB3aWR0aCA+IChvYmouY29uZmlnLm1lZGlhICYmIG9iai5jb25maWcubWVkaWEubWQpID8gJ21kJ1xuICAgICAgICAgICAgICAgIDogd2lkdGggPiAob2JqLmNvbmZpZy5tZWRpYSAmJiBvYmouY29uZmlnLm1lZGlhLnNtKSA/ICdzbScgOiAneHMnO1xuXG4gICAgICAgIGlmIChtZWRpYVN0ZXAgIT09IG5ld1N0ZXApIHtcbiAgICAgICAgICAgIG1lZGlhU3RlcCA9IG5ld1N0ZXA7XG4gICAgICAgICAgICBvYmouYnVpbGRTbGlkZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gZ2V0SXRlbXNRdWFudGl0eSgpIHtcbiAgICAgICAgcmV0dXJuIG9iai5jb25maWcuZWxlbXNQZXJQYWdlW21lZGlhU3RlcF1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvblJlc2l6ZSgpIHtcbiAgICAgICAgZ2V0TWVkaWFTdGVwKClcbiAgICB9XG5cbiAgICB2YXIgb2JqID0ge1xuICAgICAgICBhY3RpdmVJbmRleDogMCxcbiAgICAgICAgYWN0aXZlSW5kSW5kZXg6IGFjdGl2ZUluZEluZGV4ID4gMCA/IGFjdGl2ZUluZEluZGV4IDogMCxcbiAgICAgICAgdG9nZ2xlSW5kZXg6IDAsXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldE1lZGlhU3RlcCgpO1xuXG4gICAgICAgICAgICB2YXIgc3RhcnRYID0gMFxuICAgICAgICAgICAgdmFyIHRvdWNoZWQgPSBmYWxzZVxuXG4gICAgICAgICAgICB2YXIgaW5uZXIgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyLWlubmVyJyk7XG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zbGlkZXItaW5kaWNhdG9yJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTW91c2VEb3duKGUpIHtcbiAgICAgICAgICAgICAgICBzdGFydFggPSBlLmNsaWVudFggfHwgZS50b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgICAgICAgICAgdG91Y2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2Vla2x5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlc3VsdF9fd2Vla3MtYnRuJyk7XG4gICAgICAgICAgICAgICAgLy8gZm9yIChjb25zdCBpdGVtIG9mIHdlZWtseSkgaXRlbS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgc2VsZWN0V2Vlayk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICBpZiAodG91Y2hlZCkge1xuICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGlubmVyIHx8IGVsLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXItaW5uZXInKVxuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGUuY2xpZW50WCB8fCBlLnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmYgPSB4IC0gc3RhcnRYO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGRpZmYgPCAwICYmIGFjdGl2ZUluZEluZGV4IDwgaW5kaWNhdG9ycy5sZW5ndGggLSAxKSB8fCAoZGlmZiA+IDAgJiYgYWN0aXZlSW5kSW5kZXggPiAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXIuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVgoJyArIGRpZmYgKyAncHgpJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBvbk1vdXNlRW5kKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAodG91Y2hlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGUuY2xpZW50WCB8fCBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4IC0gc3RhcnRYID4gMzApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUluZGV4KGFjdGl2ZUluZEluZGV4IC0gMSlcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGFydFggLSB4ID4gMzApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUluZGV4KGFjdGl2ZUluZEluZGV4ICsgMSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGlubmVyIHx8IGVsLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXItaW5uZXInKVxuICAgICAgICAgICAgICAgICAgICBpbm5lci5zdHlsZS50cmFuc2Zvcm0gPSAnJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b3VjaGVkID0gZmFsc2VcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmlnaHRBcnJvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGVJbmRleChhY3RpdmVJbmRJbmRleCArIDEpXG4gICAgICAgICAgICAgICAgLy8gb2JqLm5leHQoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgbGVmdEFycm93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZUluZGV4KGFjdGl2ZUluZEluZGV4IC0gMSlcbiAgICAgICAgICAgICAgICAvLyBvYmoucHJldigpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25SZXNpemUpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKTtcbiAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uTW91c2VEb3duKTtcbiAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBvbk1vdXNlRG93bik7XG4gICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBvbk1vdXNlRG93bik7XG4gICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgb25Nb3VzZURvd24pO1xuICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpO1xuICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Nb3VzZU1vdmUpO1xuICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpO1xuICAgICAgICAgICAgLy8gZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Nb3VzZU1vdmUpO1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBvbk1vdXNlRW5kKTtcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9uTW91c2VFbmQpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBvbk1vdXNlRW5kKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9uTW91c2VFbmQpO1xuXG4gICAgICAgICAgICByZXR1cm4gb2JqXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgZWxlbXNQZXJQYWdlOiB7XG4gICAgICAgICAgICAgICAgLi4ue1xuICAgICAgICAgICAgICAgICAgICAnbGcnOiAzLFxuICAgICAgICAgICAgICAgICAgICAnbWQnOiAzLFxuICAgICAgICAgICAgICAgICAgICAnc20nOiAyLFxuICAgICAgICAgICAgICAgICAgICAneHMnOiAxXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi4oKGNvbmZpZyAmJiBjb25maWcuZWxlbXNQZXJQYWdlKSB8fCB7fSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZWRpYToge1xuICAgICAgICAgICAgICAgIC4uLntcbiAgICAgICAgICAgICAgICAgICAgJ2xnJzogMTE2MCxcbiAgICAgICAgICAgICAgICAgICAgJ21kJzogOTIwLFxuICAgICAgICAgICAgICAgICAgICAnc20nOiA3MDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC4uLigoY29uZmlnICYmIGNvbmZpZy5tZWRpYSkgfHwge30pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJ1aWxkU2xpZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBvYmoucmVtb3ZlU2xpZGVyKCk7XG5cblxuICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSAnc2xpZGVyLXdyYXBwZXInO1xuICAgICAgICAgICAgdmFyIGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGlubmVyLmNsYXNzTmFtZSA9ICdzbGlkZXItaW5uZXInO1xuICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChpbm5lcik7XG4gICAgICAgICAgICBlbC5hcHBlbmRDaGlsZCh3cmFwcGVyKTtcblxuICAgICAgICAgICAgaWYgKG9iai5jb25maWcuZWxlbXNQZXJQYWdlW21lZGlhU3RlcF0gPj0gaXRlbXMubGVuZ3RoICsgMSkge1xuICAgICAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ25vdC1lbm91Z2gtZWxlbXMnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWlsZFBhZ2VzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vICAgICBnZXRNZWRpYVN0ZXAoKSB7XG4gICAgICAgIC8vICAgICAvLyB2YXIgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgLy8gICAgIC8vIHZhciBuZXdTdGVwID0gd2lkdGggPiBtZWRpYUNvbmZpZyAmJiBtZWRpYUNvbmZpZy5sZyAhPT0gdW5kZWZpbmVkID8gbWVkaWFDb25maWcubGcgOiAxMTUwID8gJ2xnJ1xuICAgICAgICAvLyAgICAgLy8gICAgIDogd2lkdGggPiAobWVkaWFDb25maWcgJiYgbWVkaWFDb25maWcubWQgIT09IHVuZGVmaW5lZCA/IG1lZGlhQ29uZmlnLm1kIDogNzY3KSA/ICdtZCdcbiAgICAgICAgLy8gICAgIC8vICAgICAgICAgOiB3aWR0aCA+IChtZWRpYUNvbmZpZyAmJiBtZWRpYUNvbmZpZy5zbSAhPT0gdW5kZWZpbmVkID8gbWVkaWFDb25maWcuc20gOiA2MDApID8gJ3NtJyA6ICd4cyc7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICBpZiAobWVkaWFTdGVwICE9PSBuZXdTdGVwKSB7XG4gICAgICAgIC8vICAgICAgICAgbWVkaWFTdGVwID0gbmV3U3RlcDtcbiAgICAgICAgLy8gICAgICAgICBvYmouYnVpbGRTbGlkZXIoKTtcbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSxcbiAgICAgICAgcmVtb3ZlU2xpZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd3JhcHBlciA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXItd3JhcHBlcicpO1xuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnbm90LWVub3VnaC1lbGVtcycpXG4gICAgICAgICAgICB3cmFwcGVyICYmIHdyYXBwZXIucmVtb3ZlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvZ2dsZTogdG9nZ2xlSW5kZXhcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBidWlsZEluZGljYXRvcnMoKSB7XG4gICAgICAgIHZhciBwcmV2SW5kID0gZWwucXVlcnlTZWxlY3RvcignLnNsaWRlci1pbmRpY2F0b3JzJyk7XG4gICAgICAgIHByZXZJbmQgJiYgcHJldkluZC5yZW1vdmUoKTtcblxuICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBpbmRpY2F0b3JzLmNsYXNzTGlzdC5hZGQoJ3NsaWRlci1pbmRpY2F0b3JzJylcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmNlaWwoaXRlbXMubGVuZ3RoIC8gZ2V0SXRlbXNRdWFudGl0eSgpKTsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBpbmRpY2F0b3IuY2xhc3NMaXN0LmFkZCgnc2xpZGVyLWluZGljYXRvcicpO1xuICAgICAgICAgICAgaWYgKGkgPT09IGFjdGl2ZUluZEluZGV4KSB7XG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5kaWNhdG9yLnNldEF0dHJpYnV0ZSgnaW5kZXgnLCBpKVxuICAgICAgICAgICAgaW5kaWNhdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvZ2dsZUluZGV4KGkpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgaW5kaWNhdG9ycy5hcHBlbmRDaGlsZChpbmRpY2F0b3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdyYXBwZXIgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyLXdyYXBwZXInKVxuICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGluZGljYXRvcnMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkUGFnZXMoc3RlcCkge1xuICAgICAgICBzdGVwID0gc3RlcCB8fCAxO1xuICAgICAgICB2YXIgcGFnZVByZXYgPSBidWlsZFBhZ2Uob2JqLmFjdGl2ZUluZGV4ICsgaXRlbXMubGVuZ3RoIC0gZ2V0SXRlbXNRdWFudGl0eSgpICogc3RlcCk7XG4gICAgICAgIHZhciBwYWdlQ3VycmVudCA9IGJ1aWxkUGFnZShvYmouYWN0aXZlSW5kZXgpXG4gICAgICAgIHZhciBwYWdlTmV4dCA9IGJ1aWxkUGFnZShvYmouYWN0aXZlSW5kZXggKyBnZXRJdGVtc1F1YW50aXR5KCkgKiBzdGVwKTtcbiAgICAgICAgdmFyIGlubmVyID0gZWwucXVlcnlTZWxlY3RvcignLnNsaWRlci1pbm5lcicpO1xuICAgICAgICBpZiAoZ2V0SXRlbXNRdWFudGl0eSgpIDwgaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBidWlsZEluZGljYXRvcnMoKTtcbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvcignLnNsaWRlci1pbmRpY2F0b3IuYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAvLyB0b2dnbGVJbmRleCgwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpbm5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgaW5uZXIuYXBwZW5kQ2hpbGQocGFnZVByZXYpXG4gICAgICAgIGlubmVyLmFwcGVuZENoaWxkKHBhZ2VDdXJyZW50KVxuICAgICAgICBpbm5lci5hcHBlbmRDaGlsZChwYWdlTmV4dClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBidWlsZFBhZ2UoaW5kZXgpIHtcbiAgICAgICAgdmFyIHBhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICAgIHBhZ2UuY2xhc3NMaXN0LmFkZCgnc2xpZGVyLXBhZ2UnKVxuICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCAoaW5kZXggKyBnZXRJdGVtc1F1YW50aXR5KCkpOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBpdGVtID0gaXRlbXNbaSAlIGl0ZW1zLmxlbmd0aF07XG4gICAgICAgICAgICBsZXQgbmV3SXRlbSA9IGl0ZW0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgcGFnZS5hcHBlbmRDaGlsZChuZXdJdGVtKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYWdlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvZ2dsZUluZGV4KGluZGV4KSB7XG4gICAgICAgIHZhciBpbmRBY3RpdmUgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyLWluZGljYXRvci5hY3RpdmUnKVxuICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zbGlkZXItaW5kaWNhdG9yJyk7XG4gICAgICAgIGlmICghaW5kaWNhdG9yc1tpbmRleF0pIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgbGVmdEFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ2Fycm93LWRpc2FibGVkJyk7XG4gICAgICAgIHJpZ2h0QXJyb3cuY2xhc3NMaXN0LnJlbW92ZSgnYXJyb3ctZGlzYWJsZWQnKTtcblxuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIGxlZnRBcnJvdy5jbGFzc0xpc3QuYWRkKCdhcnJvdy1kaXNhYmxlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluZGV4ID09PSBpbmRpY2F0b3JzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHJpZ2h0QXJyb3cuY2xhc3NMaXN0LmFkZCgnYXJyb3ctZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGluZEFjdGl2ZSAmJiBpbmRBY3RpdmUuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgICAgICAgaW5kaWNhdG9yc1tpbmRleF0gJiYgaW5kaWNhdG9yc1tpbmRleF0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJylcbiAgICAgICAgaWYgKGluZGV4ID4gYWN0aXZlSW5kSW5kZXgpIHtcbiAgICAgICAgICAgIGluZGV4IC0gYWN0aXZlSW5kSW5kZXggPiAxICYmIGJ1aWxkUGFnZXMoaW5kZXggLSBhY3RpdmVJbmRJbmRleClcbiAgICAgICAgICAgIG9iai5uZXh0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPCBhY3RpdmVJbmRJbmRleCkge1xuICAgICAgICAgICAgYWN0aXZlSW5kSW5kZXggLSBpbmRleCA+IDEgJiYgYnVpbGRQYWdlcyhhY3RpdmVJbmRJbmRleCAtIGluZGV4KVxuICAgICAgICAgICAgb2JqLnByZXYoKVxuICAgICAgICB9XG4gICAgICAgIGFjdGl2ZUluZEluZGV4ID0gaW5kZXhcbiAgICAgICAgLy8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmN1cnJlbnQnKS50ZXh0Q29udGVudCA9IGFjdGl2ZUluZEluZGV4ICsgMTtcbiAgICB9XG5cbiAgICBvYmoucHJldiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdyYXBwZXIgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyLXdyYXBwZXInKVxuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3ByZXYnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3ByZXYnKVxuICAgICAgICAgICAgb2JqLmFjdGl2ZUluZGV4ID0gKG9iai5hY3RpdmVJbmRleCAtIGdldEl0ZW1zUXVhbnRpdHkoKSArIGl0ZW1zLmxlbmd0aCkgJSBpdGVtcy5sZW5ndGg7XG4gICAgICAgICAgICBidWlsZFBhZ2VzKClcbiAgICAgICAgfSwgMzAwKTtcbiAgICB9XG5cbiAgICBvYmoubmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdyYXBwZXIgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyLXdyYXBwZXInKVxuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ25leHQnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ25leHQnKVxuICAgICAgICAgICAgb2JqLmFjdGl2ZUluZGV4ID0gKG9iai5hY3RpdmVJbmRleCArIGdldEl0ZW1zUXVhbnRpdHkoKSArIGl0ZW1zLmxlbmd0aCkgJSBpdGVtcy5sZW5ndGg7XG4gICAgICAgICAgICBidWlsZFBhZ2VzKClcbiAgICAgICAgfSwgMzAwKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iai5pbml0KCk7XG59XG4iLCIiXX0=
